<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <script>
    //Task1
    let str = "Hello";

    str.test = 5;

    alert(str.test);
    //it won't work, since it'll be a property of the wrapper object which will disappear leaving str without the test
    //attribute

    //Task2
    let a = +prompt("first number", "1");
    let b = +prompt("second number", "2");

    alert( a + b );
    //Task3
    alert((6.35*10).toFixed(0)/10);

    //Task4
    function read() {
        let num;

        do {
            num = prompt("Enter a number:", 0);
        } while ( !isFinite(num) );

        if (!num && num !== 0) return null;

        return +num;
    }

    alert(`Read: ${read()}`);

    //Task5
    //precision losses

    //Task6
    function rand(min, max) {
        return Math.random()*(max-min)+min;
    }
    //alert(rand(3,8));

    //Task7
    function randint(min,max) {
        min -= 0.49;
        max += 0.49;
        return Math.round(Math.random()*(max-min)+min);
    }
    //alert(randint(2,4));

    //Task8
    function ucFirst(name) {
        return name[0].toUpperCase()+name.slice(1);
    }
    alert(ucFirst("john"));

    //Task9
    function checkSpam(spam) {
        return spam.toLowerCase().includes("viagra") || spam.toLowerCase().includes("xxx");
    }

    if (checkSpam('buy ViAgRA now')) alert("spam");
    else alert("legit");
    if (checkSpam('free xxxxx')) alert("spam");
    else alert("legit");
    if (checkSpam("innocent rabbit")) alert("spam");
    else alert("legit");

    //Task10
    function truncate(str, maxlength) {
        return (str.length > maxlength) ? str.slice(0, maxlength - 1) + 'â€¦' : str;
    }

    //Task11
    //it'd be 4 cause its reference gets copied not its content

    //Task12
    let styles = ["Jazz", "Blues"];
    styles.push("Rock-n-Roll");
    styles[Math.floor((styles.length - 1) / 2)] = "Classics";
    alert(styles.shift());
    styles.unshift("Rap", "Reggae");

    //Task13
    //the array contents get printed with an alert, because the function is being called which returns the referrer via
    //"this" keyword and the referrer in question is the array

    //Task14
    function sumInput() {
        let numbers = [];
        while (true) {
            let value = prompt("Enter a number:", 0);
            if (value === "" || value === null || !isFinite(+value)) break;
            numbers.push(+value);
        }

        let sum = 0;
        for (let num of numbers) {
            sum += num;
        }

        return sum;
    }

    alert(sumInput());

    //Task15
    function getMaxSubSum(arr)
    {
        let max = 0;
        let part = 0;

        for (let item of arr)
        {
            part += item;
            max = Math.max(max, part);
            if (part < 0) part = 0;
        }

        return max;
    }

    //Task16
    function camelize(str) {
        return str.split('-')
            .map( (word, index) => index == 0 ? word : word[0].toUpperCase() + word.slice(1) )
            .join('');
    }

    //Task17
    function filterRange(arr, a, b) {
        return arr.filter(item => (a <= item && item <= b));
    }

    //Task18
    function filterRangeInPlace(arr, a, b) {
        for (let i = 0; i < arr.length; i++) {
            let val = arr[i];
            if (val < a || val > b) {
                arr.splice(i, 1);
                i--;
            }
        }
    }

    //Task19
    let arr = [9, 3, 7, 50, -5];

    arr.sort((a, b) => b - a);

    //Task20
    function copySorted(arr) {
        return arr.slice().sort();
    }

    //Task21
    function Calculator() {

        this.methods = {
            "-": (a, b) => a - b,
            "+": (a, b) => a + b
        };

        this.calculate = function(str) {

            let split = str.split(' '),
                a = +split[0],
                op = split[1],
                b = +split[2];

            if (!this.methods[op] || isNaN(a) || isNaN(b)) {
                return NaN;
            }

            return this.methods[op](a, b);
        };

        this.addMethod = function(name, func) {
            this.methods[name] = func;
        };
    }

    //Task22
    let john = {name: "John", age: 25};
    let pete = {name: "Pete", age: 30};
    let mary = {name: "Mary", age: 28};

    let users = [john, pete, mary];

    let names = users.map(item => item.name);

    //Task23
    let users2 = users.map(user => ({fullName : `${user.name} ${user.surname}`, id : `${user.id}`}));

    //Task24
    function sortByAge(arr) {
        arr.sort((a, b) => a.age - b.age);
    }

    //Task25
    function sortByAge(arr) {
        arr.sort((a, b) => a.age - b.age);
    }

    //Task26
    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            let j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    //Task27
    function getAverageAge(users) {
        return users.reduce((prev, user) => prev + user.age, 0) / users.length;
    }

    //Task28
    function unique(arr)
    {
        let result = [];
        for (let str of arr) {
            if (!result.includes(str)) {
                result.push(str);
            }
        }
        return result;
    }

    //Task29
    function groupById(array)
    {
        return array.reduce((obj, value) => {
            obj[value.id] = value;
            return obj;
        }, {})
    }

    //Task30
    function unique(arr)
    {
        return Array.from(new Set(arr));
    }

    //Task31
    function aclean(arr) {
        let map = new Map();

        for (let word of arr)
        {
            let sorted = word.toLowerCase().split('').sort().join('');
            map.set(sorted, word);
        }
        return Array.from(map.values());
    }

    //Task32
    //it's iterable, not an array but we can make it one
    let keys = Array.from(map.keys());

    //Task33
    let messages = [
        {text: "Hello", from: "John"},
        {text: "How goes?", from: "John"},
        {text: "See you soon", from: "Alice"}
    ];

    let readMessages = new WeakSet();

    readMessages.add(messages[0]);
    readMessages.add(messages[1]);
    alert("Read message 0: " + readMessages.has(messages[0]));
    messages.shift();

    //Task34
    let readMap = new WeakMap();
    readMap.set(messages[0], new Date(1970, 1, 1));

    //Task35
    function sumSalaries(salaries) {
        let sum = 0;
        for (let salary of Object.values(salaries)) {
            sum += salary;
        }
        return sum;
    }

    let salaries = {
        "John": 100,
        "Pete": 300,
        "Mary": 250
    };

    //Task36
    function count(obj) {
        return Object.keys(obj).length;
    }

    //Task37
    let user = {
        name: "John",
        years: 30
    };

    let {name, years: age, isAdmin = false} = user;

    //Task38
    function topSalary(salaries) {
        let maxSalary = 0;
        let maxName = null;
        for(const [name, salary] of Object.entries(salaries)) {
            if (maxSalary < salary) {
                maxSalary = salary;
                maxName = name;
            }
        }
        return maxName;
    }

    //Task39
    let date1 = new Date(1970, 1, 1, 1, 1);
    alert( date1 );

    //Task40
    function getWeekDay(date) {
        let days = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
        return days[date.getDay()];
    }

    //Task41
    function getLocalDay(date) {
        let day = date.getDay();

        if (day == 0) {
            day = 7;
        }

        return day;
    }

    //Task42
    function getDateAgo(date, days) {
        let dateCopy = new Date(date);

        dateCopy.setDate(date.getDate() - days);
        return dateCopy.getDate();
    }

    //Task43
    function getLastDayOfMonth(year, month) {
        let date = new Date(year, month + 1, 0);
        return date.getDate();
    }

    //Task44
    function getSecondsToday() {
        let d = new Date();
        return d.getHours() * 3600 + d.getMinutes() * 60 + d.getSeconds();
    }

    //Task45
    function getSecondsToTomorrow() {
        let now = new Date();
        let hour = now.getHours();
        let minutes = now.getMinutes();
        let seconds = now.getSeconds();
        let totalSecondsToday = (hour * 60 + minutes) * 60 + seconds;
        let totalSecondsInADay = 86400;

        return totalSecondsInADay - totalSecondsToday;
    }

    //Task46
    function formatDate(date) {
        let dayOfMonth = date.getDate();
        let month = date.getMonth() + 1;
        let year = date.getFullYear();
        let hour = date.getHours();
        let minutes = date.getMinutes();
        let diffMs = new Date() - date;
        let diffSec = Math.round(diffMs / 1000);
        let diffMin = diffSec / 60;
        let diffHour = diffMin / 60;

        year = year.toString().slice(-2);
        month = month < 10 ? '0' + month : month;
        dayOfMonth = dayOfMonth < 10 ? '0' + dayOfMonth : dayOfMonth;
        hour = hour < 10 ? '0' + hour : hour;
        minutes = minutes < 10 ? '0' + minutes : minutes;

        if (diffSec < 1) {
            return 'right now';
        } else if (diffMin < 1) {
            return `${diffSec} sec. ago`
        } else if (diffHour < 1) {
            return `${diffMin} min. ago`
        } else {
            return `${dayOfMonth}.${month}.${year} ${hour}:${minutes}`
        }
    }

    //Task47
    let user2 = JSON.parse(JSON.stringify(user));

    //Task48
    let room = {
        number: 23
    };

    let meetup = {
        title: "Conference",
        occupiedBy: [{name: "John"}, {name: "Alice"}],
        place: room
    };

    room.occupiedBy = meetup;
    meetup.self = meetup;

    alert( JSON.stringify(meetup, function replacer(key, value) {
        return (key != "" && value == meetup) ? undefined : value;
    }));

  </script>
</head>
<body>

</body>
</html>